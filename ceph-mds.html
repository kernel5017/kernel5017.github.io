<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ceph-mds | 豪仔的老爹</title><meta name="author" content="豪仔的老爹"><meta name="copyright" content="豪仔的老爹"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="MDS状态解释MDS常见状态MDS有 以下几个常见的状态： 1up:active  这是MDS的正常运行状态，表示MDS和它的rank是可用状态 1up:standby  表示MDS可用于接管失败的rank？？？ 1up:standby-replay  这个状态的MDS与现有的up:active的MDS是同步的，它在实时更新日志，确保与up:active状态的MDS数据同步。如果active MD">
<meta property="og:type" content="article">
<meta property="og:title" content="ceph-mds">
<meta property="og:url" content="https://www.for-dba.com/ceph-mds.html">
<meta property="og:site_name" content="豪仔的老爹">
<meta property="og:description" content="MDS状态解释MDS常见状态MDS有 以下几个常见的状态： 1up:active  这是MDS的正常运行状态，表示MDS和它的rank是可用状态 1up:standby  表示MDS可用于接管失败的rank？？？ 1up:standby-replay  这个状态的MDS与现有的up:active的MDS是同步的，它在实时更新日志，确保与up:active状态的MDS数据同步。如果active MD">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2020-12-01T06:34:52.000Z">
<meta property="article:modified_time" content="2020-12-03T00:55:46.977Z">
<meta property="article:author" content="豪仔的老爹">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://www.for-dba.com/ceph-mds"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-12-03 08:55:46'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/null" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">15</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">9</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 数据库&amp;存储</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/mysql/index.html"><span> MySQL</span></a></li><li><a class="site-page" href="/categories/etcd/"><span> ETCD</span></a></li><li><a class="site-page" href="/categories/redis/"><span> Redis</span></a></li><li><a class="site-page" href="/ceph/index.html"><span> Ceph</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Linux</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/shell/index.html"><span> Shell</span></a></li><li><a class="site-page" href="/categories/iptables/"><span> Iptables</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Kubernetes</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/rke/"><span> rke</span></a></li><li><a class="site-page" href="/kubernetes/index.html"><span> kubernetes</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 监控</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/prometheus/index.html"><span> Prometheus</span></a></li><li><a class="site-page" href="/categories/grafana/"><span> Grafana</span></a></li><li><a class="site-page" href="/categories/alertmanager/"><span> AlertMnager</span></a></li><li><a class="site-page" href="/categories/zabbix/"><span> Zabbix</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 开发</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/golang/index.html"><span> Golang</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">豪仔的老爹</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 数据库&amp;存储</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/mysql/index.html"><span> MySQL</span></a></li><li><a class="site-page" href="/categories/etcd/"><span> ETCD</span></a></li><li><a class="site-page" href="/categories/redis/"><span> Redis</span></a></li><li><a class="site-page" href="/ceph/index.html"><span> Ceph</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Linux</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/shell/index.html"><span> Shell</span></a></li><li><a class="site-page" href="/categories/iptables/"><span> Iptables</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Kubernetes</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/categories/rke/"><span> rke</span></a></li><li><a class="site-page" href="/kubernetes/index.html"><span> kubernetes</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 监控</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/prometheus/index.html"><span> Prometheus</span></a></li><li><a class="site-page" href="/categories/grafana/"><span> Grafana</span></a></li><li><a class="site-page" href="/categories/alertmanager/"><span> AlertMnager</span></a></li><li><a class="site-page" href="/categories/zabbix/"><span> Zabbix</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 开发</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/golang/index.html"><span> Golang</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ceph-mds</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2020-12-01T06:34:52.000Z" title="Created 2020-12-01 14:34:52">2020-12-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-12-03T00:55:46.977Z" title="Updated 2020-12-03 08:55:46">2020-12-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ceph/">ceph</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="MDS状态解释"><a href="#MDS状态解释" class="headerlink" title="MDS状态解释"></a>MDS状态解释</h1><h2 id="MDS常见状态"><a href="#MDS常见状态" class="headerlink" title="MDS常见状态"></a>MDS常见状态</h2><p>MDS有 以下几个常见的状态：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">up:active</span><br></pre></td></tr></table></figure>

<p>这是MDS的正常运行状态，表示MDS和它的rank是可用状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">up:standby</span><br></pre></td></tr></table></figure>

<p>表示MDS可用于接管失败的rank？？？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">up:standby-replay</span><br></pre></td></tr></table></figure>

<p>这个状态的MDS与现有的up:active的MDS是同步的，它在实时更新日志，确保与up:active状态的MDS数据同步。如果active MDS发生故障了，那么处于standby-replay状态的MDS可以最快速的进行接管，</p>
<p>standby-replay的缺点就是它无法接管任何失败的MDS，它们只能接管他们所follow的MDS。就是说standby-replay与active的mds是配对的关系，只有对应的active mds失效了，它才能接管，其他active mds失效了，它无法接管。</p>
<h2 id="MDS不常见状态或非常短暂的状态"><a href="#MDS不常见状态或非常短暂的状态" class="headerlink" title="MDS不常见状态或非常短暂的状态"></a>MDS不常见状态或非常短暂的状态</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">up:boot</span><br></pre></td></tr></table></figure>

<p>当MDS启动期间会将此状态广播给monitors.这种状态是不可见的，因为monitor将会立即将MDS置位可用状态，或者命令MDS作为一个standby。这里记录此状态只是为了文档完整</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">up:creating</span><br></pre></td></tr></table></figure>

<p>The MDS is creating a new rank (perhaps rank 0) by constructing some per-rank metadata (like the journal) and entering the MDS cluster.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">up:starting</span><br></pre></td></tr></table></figure>

<p>The MDS is restarting a stopped rank. It opens associated per-rank metadata and enters the MDS cluster.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">up:stopping</span><br></pre></td></tr></table></figure>

<p>When a rank is stopped, the monitors command an active MDS to enter the <code>up:stopping</code> state. In this state, the MDS accepts no new client connections, migrates all subtrees to other ranks in the file system, flush its metadata journal, and, if the last rank (0), evict all clients and shutdown</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">up:replay</span><br></pre></td></tr></table></figure>

<p>表示MDS接管了一个failed rank。这个状态表示MDS正在恢复其日志和其他元数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">up:resolve</span><br></pre></td></tr></table></figure>

<p>MDS从up:replay到此状态，如果ceph file system有多个ranks(包含这一个)，那么这个集群不是“单MDS”集群，即多MDS集群。表示MDS正在 resolving any uncommitted inter-MDS operations。All ranks in the file system must be in this state or later for progress to be made, i.e. no rank can be failed/damaged or <code>up:replay</code>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">up:reconnect</span><br></pre></td></tr></table></figure>

<p>MDS会从up:replay或up:resolve进入此状态。这个状态表示从客户端重新请求连接。任何与这个rank有session的client在这时都必须进行重连， configurable via <code>mds_reconnect_timeout</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">up:rejoin</span><br></pre></td></tr></table></figure>

<p>The MDS enters this state from <code>up:reconnect</code>. In this state, the MDS is rejoining the MDS cluster cache. In particular, all inter-MDS locks on metadata are reestablished.</p>
<p>If there are no known client requests to be replayed, the MDS directly becomes <code>up:active</code> from this state.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">up:clientreplay</span><br></pre></td></tr></table></figure>

<p>The MDS may enter this state from <code>up:rejoin</code>. The MDS is replaying any client requests which were replied to but not yet durable (not journaled). Clients resend these requests during <code>up:reconnect</code> and the requests are replayed once again. The MDS enters <code>up:active</code> after completing replay.</p>
<h2 id="MDS-FAILED状态"><a href="#MDS-FAILED状态" class="headerlink" title="MDS FAILED状态"></a>MDS FAILED状态</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">down:failed</span><br></pre></td></tr></table></figure>

<p>没有MDS会处于这个状态，其实file system中的rank会有这个状态，比如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ceph fs dump</span><br><span class="line">max_mds 1</span><br><span class="line">in      0</span><br><span class="line">up      &#123;&#125;</span><br><span class="line">failed  0</span><br></pre></td></tr></table></figure>

<p>上面表示rank0 是failed的</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">down:damaged</span><br></pre></td></tr></table></figure>

<p>没有MDS会处于这个状态，其实file system中的rank会有这个状态，比如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ceph fs dump</span></span><br><span class="line">max_mds 1</span><br><span class="line">in      0</span><br><span class="line">up      &#123;&#125;</span><br><span class="line">failed</span><br><span class="line">damaged 0</span><br></pre></td></tr></table></figure>

<p>rank0已经变为damaged状态，如果一个关联rank0的MDS发现metadata损坏了，是不能自动回复的，需要手动干预。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">down:stopped</span><br></pre></td></tr></table></figure>

<p>No MDS actually holds this state. Instead, it is applied to the rank in the file system. For example:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ceph fs dump</span></span><br><span class="line">...</span><br><span class="line">max_mds 1</span><br><span class="line">in      0</span><br><span class="line">up      &#123;&#125;</span><br><span class="line">failed</span><br><span class="line">damaged</span><br><span class="line">stopped 1</span><br></pre></td></tr></table></figure>

<p>The rank has been stopped by reducing <code>max_mds</code></p>
<h2 id="MDS状态机"><a href="#MDS状态机" class="headerlink" title="MDS状态机"></a>MDS状态机</h2><p>颜色：</p>
<ul>
<li>Green: MDS is active.</li>
<li>Orange: MDS is in transient state trying to become active.</li>
<li>Red: MDS is indicating a state that causes the rank to be marked failed.</li>
<li>Purple: MDS and rank is stopping.</li>
<li>Black: MDS is indicating a state that causes the rank to be marked damaged.</li>
</ul>
<p>形状：</p>
<ul>
<li>Circle: an MDS holds this state.</li>
<li>Hexagon: no MDS holds this state (it is applied to the rank).</li>
</ul>
<p>线条：</p>
<p>​       A double-lined shape indicates the rank is “in”.</p>
<p><img src="https://5017-1304333899.cos.ap-beijing.myqcloud.com/ceph-mds/mds-state-diagram.svg" alt="mds-state-diagram"></p>
<hr>
<h1 id="MDS故障转移管理"><a href="#MDS故障转移管理" class="headerlink" title="MDS故障转移管理"></a>MDS故障转移管理</h1><p>​    如果一个MDS daemon停止了与monitor的通信，monitor还是会等待这个MDS daemon mds_beacon_grace秒的时间（默认为15秒），当超过这个时间，monitor会将这个mds daemon标记为laggy。此时如果有standby是可用的，那么monitor会立即将当前的laggy mds daemon替换掉。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">豪仔的老爹</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://www.for-dba.com/ceph-mds.html">https://www.for-dba.com/ceph-mds.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/prometheus-relabels.html"><img class="prev-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">prometheus-relabels</div></div></a></div><div class="next-post pull-right"><a href="/ceph-k8s%E4%BD%BF%E7%94%A8ceph%E5%AD%98%E5%82%A8.html"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">k8s使用ceph存储数据</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="/null" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">豪仔的老爹</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">15</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">9</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">邮件交流：365084797@qq.com</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MDS%E7%8A%B6%E6%80%81%E8%A7%A3%E9%87%8A"><span class="toc-number">1.</span> <span class="toc-text">MDS状态解释</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MDS%E5%B8%B8%E8%A7%81%E7%8A%B6%E6%80%81"><span class="toc-number">1.1.</span> <span class="toc-text">MDS常见状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MDS%E4%B8%8D%E5%B8%B8%E8%A7%81%E7%8A%B6%E6%80%81%E6%88%96%E9%9D%9E%E5%B8%B8%E7%9F%AD%E6%9A%82%E7%9A%84%E7%8A%B6%E6%80%81"><span class="toc-number">1.2.</span> <span class="toc-text">MDS不常见状态或非常短暂的状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MDS-FAILED%E7%8A%B6%E6%80%81"><span class="toc-number">1.3.</span> <span class="toc-text">MDS FAILED状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MDS%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="toc-number">1.4.</span> <span class="toc-text">MDS状态机</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MDS%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%AE%A1%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">MDS故障转移管理</span></a></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/prometheus-nodeexporter-problem-diskfound.html" title="prometheus-nodeexporter-problem-diskfound">prometheus-nodeexporter-problem-diskfound</a><time datetime="2020-12-09T08:52:16.000Z" title="Created 2020-12-09 16:52:16">2020-12-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/linux-tool-sysbench.html" title="linux-tool-sysbench">linux-tool-sysbench</a><time datetime="2020-12-09T08:20:51.000Z" title="Created 2020-12-09 16:20:51">2020-12-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/linux-tool-stress.html" title="linux-tool-stress">linux-tool-stress</a><time datetime="2020-12-09T02:50:03.000Z" title="Created 2020-12-09 10:50:03">2020-12-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/ceph-mds-deploy.html" title="ceph-mds-deploy">ceph-mds-deploy</a><time datetime="2020-12-04T03:09:43.000Z" title="Created 2020-12-04 11:09:43">2020-12-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/prometheus-relabels2.html" title="prometheus-relabels2">prometheus-relabels2</a><time datetime="2020-12-03T09:02:48.000Z" title="Created 2020-12-03 17:02:48">2020-12-03</time></div></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2020 By 豪仔的老爹</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    let initData = {
      el: '#vcomment',
      appId: '8pmThnDCYUdGoOgLWsVPzKOI-gzGzoHsz',
      appKey: 'nt3vchWbGYf7q7Txb7PjAu1B',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign({}, initData, otherData)
    }
    
    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script></div></body></html>